!function(e){function t(t){for(var n,s,c=t[0],i=t[1],_=t[2],p=0,l=[];p<c.length;p++)s=c[p],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&l.push(a[s][0]),a[s]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);for(u&&u(t);l.length;)l.shift()();return o.push.apply(o,_||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,c=1;c<r.length;c++){var i=r[c];0!==a[i]&&(n=!1)}n&&(o.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},a={9:0},o=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="https://db-nica.ru/build_ci/sveden/";var c=window.webpackJsonp=window.webpackJsonp||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var _=0;_<c.length;_++)t(c[_]);var u=i;o.push([1061,0]),r()}({1:function(e,t,r){e.exports=r(127)},1055:function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),_helpers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(582),WORK_DONE=1,WORK_WASTED=-1,messageContainer=$_vikon("#message-container"),processContainer=$_vikon("#process-container"),newVersion=$_vikon("#new-version"),noEnter=$_vikon("#no-enter"),yesEnter=$_vikon("#yes-enter"),waitLoad=$_vikon("#wait-load"),startUpdate=$_vikon("#start-update"),progressbarContainer=$_vikon("#progressbar-container"),progressbar=$_vikon("#progressbar"),updateComplete=$_vikon("#update-complete"),clearTmpFilesErrorLayout=$_vikon("#clear_tmp_error_layout"),filesForSync=[],btnExit=$_vikon("#exit"),parts=[],debugMode=0,noDelFilePhp=0,countFilesInBatch=5,$btnEnter=$_vikon($_vikon("#enter-vikon").get(0)),domenObj=$_vikon("[name=domen]").get(0),domen="".concat(location.protocol,"//").concat($_vikon(domenObj).val()),apiDomenObj=$_vikon("[name=api_domen]").get(0),apiDomen=$_vikon(apiDomenObj).val(),clientIdObj=$_vikon("[name=client_id]").get(0),clientId=$_vikon(clientIdObj).val(),currentVersionObj=$_vikon("[name=current_version]").get(0),currentVersion=$_vikon(currentVersionObj).val(),codeObj=$_vikon("[name=code]").get(0),code=$_vikon(codeObj).val();function Oauth(){this.setToken=function(){var e=window.localStorage.getItem("vikon_access_token"),t=window.localStorage.getItem("vikon_refresh_token"),r=window.localStorage.getItem("vikon_code");return new Promise((function(n){if(e){var a=function(e){return new Promise((function(t,r){$_vikon.post("".concat(apiDomen,"oauth2/resource/checkToken"),{access_token:e}).done((function(){t(!0)})).fail((function(){r(new Error("Токен доступа не прошел проверку."))}))}))}(e);a.then((function(){n(!0)})).catch((function(){o()}))}else o();function o(){if(t){var e=function(e){return new Promise((function(t,r){$_vikon.post("".concat(domen,"/sveden/update/refresh_access_token.php"),{refresh_token:e}).done((function(e){e.success&&e.access_token&&e.refresh_token?(window.localStorage.setItem("vikon_access_token",e.access_token),window.localStorage.setItem("vikon_refresh_token",e.refresh_token),t(!0)):r(new Error("Не удалось обновить токен доступа."))})).fail((function(){r(new Error("Не удалось обновить токен доступа."))}))}))}(t);e.then((function(){n(!0)})).catch((function(){s()}))}else s()}function s(){if(r){var e=function(e){return new Promise((function(t,r){$_vikon.post("".concat(domen,"/sveden/update/get_access_token.php"),{code:e,domen:domen},(function(e){e.success&&(window.localStorage.setItem("vikon_access_token",e.access_token),window.localStorage.setItem("vikon_refresh_token",e.refresh_token),t(!0)),r(new Error("Не удалось получить токен доступа."))})).fail((function(){r(new Error("Не удалось получить токен доступа."))}))}))}(r);e.then((function(){n(!0)})).catch((function(){n(!1)}))}else n(!1)}})).catch((function(e){throw e}))},this.getToken=function(){return window.localStorage.getItem("vikon_access_token")},this.redirectUpdatePage=function(){window.location.href="".concat(domen,"/sveden/update")}}function Updater(){var url,data,onSuccess,attempts=0,methodAjax="GET",unlockedRuningOnError=!0;this.setMethodAjax=function(e){methodAjax=e},this.setUrl=function(e){url=e},this.setData=function(e){data=e},this.setOnSuccess=function(e){onSuccess=e},this.setUnlockedRuningOnError=function(e){unlockedRuningOnError=e},this.resetSettings=function(){url="",data={},onSuccess=void 0,attempts=0,methodAjax="GET",unlockedRuningOnError=!0},this.sendAjax=function(critical,nameFunc){return void 0===critical&&(critical=!0),void 0===methodAjax&&(methodAjax="GET"),new Promise((function(resolve){data.debug_mode=debugMode,data.no_del_file_php=noDelFilePhp,$_vikon.ajax({type:methodAjax,url:url,headers:{Accept:"application/json"},dataType:"json",data:data,success:function success(res){if(void 0!==onSuccess)return onSuccess(res),resolve(res);var isErrToken=void 0!==res.error&&("invalid_token"===res.error||"Authorization failed"===res.error);if(res.success){if(res.message&&processContainer.prepend("<p>".concat(res.message,"</p>")),critical)return resolve(res)}else if(isErrToken&&0===attempts&&void 0!==nameFunc){var promiseSetToken=oauth.setToken();promiseSetToken.then((function(success){if(success){attempts++,data.access_token=oauth.getToken();var promiseSend=updater.sendAjax();promiseSend.then((function(res){eval(nameFunc)}))}else oauth.redirectUpdatePage()}))}else res.message&&(processContainer.prepend('<p class="text-danger">Ошибка: '.concat(res.message,"</p>")),progressbarContainer.hide(),unlockedRuningOnError&&completeErrorAsync());return critical?void 0:resolve(res)},error:function(e,t,r){(processContainer.prepend('<p class="text-danger">Ошибка: '.concat(t," ").concat(r,"</p>")),401===e.status&&0===attempts)?oauth.setToken().then((function(e){e?(attempts++,data.access_token=oauth.getToken(),updater.sendAjax().then((function(e){return resolve(e)}))):oauth.redirectUpdatePage()})):unlockedRuningOnError&&completeErrorAsync()}})}))},this.addMessage=function(e){processContainer.prepend("<p>".concat(e,"</p>"))}}function ProgressbarControl(){this.setActive=function(){progressbar.addClass("active")},this.setDeactive=function(){progressbar.removeClass("active")},this.setVal=function(e){progressbar.css("width","".concat(e,"%")),progressbar.html("".concat(e,"%"))}}function disabledAccess(e,t){-1===e.indexOf(t.val())&&(t.is(":checked")&&t.attr("checked",!1),t.attr("disabled",!0),t.parent().addClass("disabled"),t.next().prepend('<span class="text-danger">Нет прав</span> '))}if(code&&window.localStorage.setItem("vikon_code",code),$_vikon((function(){Object(_helpers__WEBPACK_IMPORTED_MODULE_2__.a)(location.search).enter&&$btnEnter.click()})),window.localStorage){var oauth=new Oauth,updater=new Updater,progressControl=new ProgressbarControl;oauth.setToken().then(function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t){var r,n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=18;break}return e.next=3,getAccessListAsync();case 3:return r=e.sent,$_vikon('input[name="part"]').each((function(){disabledAccess(r,$_vikon(this))})),disabledAccess(r,$_vikon('input[name="sync"]')),-1!==r.indexOf("admin_mode")&&$_vikon("#admin-mode-panel").removeClass("hide"),-1!==r.indexOf("no_update_abitur")&&$_vikon("#abitur").closest("li").remove(),-1!==r.indexOf("no_del_file_php")&&(noDelFilePhp=1),waitLoad.remove(),yesEnter.show(),btnExit.show(),e.next=14,getVersionAsync();case 14:null===(n=e.sent)||currentVersion!==n?newVersion.removeClass("label-warning").addClass("label-success").html(n):(newVersion.removeClass("label-warning").addClass("label-default"),newVersion.html("обновления отсутствуют")),e.next=20;break;case 18:waitLoad.remove(),noEnter.show();case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){messageContainer.html(e.message).show()}))}else waitLoad.remove(),messageContainer.html("Объект localStorage не поддерживается данным браузером. Пожалуйста, воспользуйтесь другим Internet-браузером.").show();function get(){return _get.apply(this,arguments)}function _get(){return(_get=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(progressControl.setActive(),progressControl.setVal(10),!$_vikon('input[name="no_core"]').is(":checked")){e.next=9;break}return processContainer.prepend("<p>Обновление ядра отключено.</p>"),e.next=6,pullParts();case 6:getCountFiles(),e.next=17;break;case 9:return e.next=11,getCoreAsync();case 11:return t=e.sent,e.next=14,unpackAsync(t);case 14:return e.next=16,pullParts();case 16:getCountFiles();case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function getCoreAsync(){return _getCoreAsync.apply(this,arguments)}function _getCoreAsync(){return(_getCoreAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return progressControl.setActive(),progressControl.setVal(10),processContainer.prepend("<p>Начинается обновление скриптов обновления.</p>"),t={type:"get",url:"".concat(domen,"/sveden/update/get_core.php"),headers:{Accept:"application/json"},dataType:"json",data:{}},e.prev=4,e.next=7,requestToVuzRemoteScriptWithRepetitionAsync(t,!0,oauth);case 7:if(r=e.sent,200===(n=r.respData).forward_code&&n.version){e.next=11;break}throw new Error(n.message?n.message:"Неопознанная ошибка");case 11:return processContainer.prepend("<p>".concat(n.message,"</p>")),e.abrupt("return",n.version);case 15:return e.prev=15,e.t0=e.catch(4),processContainer.prepend('<p class="text-danger">'.concat(e.t0.message)),e.next=20,showUpdateEndMessage(!1);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function unpackAsync(e){return _unpackAsync.apply(this,arguments)}function _unpackAsync(){return(_unpackAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t){var r,n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return progressControl.setVal(20),r={type:"get",url:"".concat(domen,"/sveden/update/unpack.php"),headers:{Accept:"application/json"},dataType:"json",data:{version:t}},e.prev=2,e.next=5,requestToVuzRemoteScriptWithRepetitionAsync(r,!0,oauth);case 5:if(n=e.sent,200===(a=n.respData).forward_code){e.next=9;break}throw new Error(a.message?a.message:"Неопознанная ошибка");case 9:e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(2),processContainer.prepend('<p class="text-danger">'.concat(e.t0.message)),e.next=16,completeErrorAsync();case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}function pullParts(){return _pullParts.apply(this,arguments)}function _pullParts(){return(_pullParts=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n,a,o,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],$_vikon('input[name="part"]:checked').each((function(){t.push($_vikon(this).val())})),r=0;case 3:if(!(r<t.length)){e.next=29;break}return n=t[r],progressControl.setVal(20+3*r),e.prev=6,e.next=9,createPartRequestAsync(n);case 9:return a=e.sent,o=a.operationIdentity,s=a.ttl,e.next=14,waitPartAsync(o,s);case 14:return e.next=16,checkPartResultAsync(o,n);case 16:return e.next=18,downloadPartResultAsync(o,n);case 18:e.next=26;break;case 20:return e.prev=20,e.t0=e.catch(6),processContainer.prepend('<p class="text-danger">'.concat(e.t0.message,"</p>")),e.next=25,completeErrorAsync();case 25:throw e.t0;case 26:r++,e.next=3;break;case 29:case"end":return e.stop()}}),e,null,[[6,20]])})))).apply(this,arguments)}function waitPartAsync(e,t){return _waitPartAsync.apply(this,arguments)}function _waitPartAsync(){return(_waitPartAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r){var n,a,o,s,c,i,_,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r||350,a=function(e){return new Promise((function(t){return setTimeout(t,e)}))},o={type:"get",url:"".concat(domen,"/sveden/update/status_generate_part.php"),headers:{Accept:"application/json"},dataType:"json",data:{operation_identity:t}},s=Date.now()/1e3,e.prev=4,c=3,i=0;case 7:if(!(Date.now()/1e3-s<n)){e.next=31;break}return e.next=10,a(1e3*c);case 10:return c=(i+=1)>3?c+(i-3):c,_={},e.prev=13,e.next=16,requestToVuzRemoteScriptWithRepetitionAsync(o,!0,oauth);case 16:u=e.sent,_=u.respData,e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(13),new Error("не удалось получить статус процесса генерации");case 23:if(200===_.forward_code){e.next=25;break}throw new Error(_.message?_.message:"неопознанная ошибка");case 25:if(_.status!==WORK_WASTED){e.next=27;break}throw new Error("не удалось сгенерировать архив. Попробуйте запусить процесс обновления заново.");case 27:if(_.status!==WORK_DONE){e.next=29;break}return e.abrupt("return");case 29:e.next=7;break;case 31:throw new Error("не удалось дождаться результата генерации за приемлемое время");case 34:throw e.prev=34,e.t1=e.catch(4),new Error("Ошибка генерации архива с разделом: ".concat(e.t1.message));case 37:case"end":return e.stop()}}),e,null,[[4,34],[13,20]])})))).apply(this,arguments)}function downloadPartResultAsync(e,t){return _downloadPartResultAsync.apply(this,arguments)}function _downloadPartResultAsync(){return(_downloadPartResultAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r){var n,a,o;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={type:"post",url:"".concat(domen,"/sveden/update/result_download_part.php"),headers:{Accept:"application/json"},dataType:"json",data:{operation_identity:t,part:r}},e.next=4,requestToVuzRemoteScriptWithRepetitionAsync(n,!0,oauth);case 4:if(a=e.sent,200===(o=a.respData).forward_code){e.next=8;break}throw new Error(o.message?o.message:"неопознанная ошибка");case 8:processContainer.prepend("<p>".concat(o.message)),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),new Error("Ошибка при загрузке результатов генерации архива с разделом: ".concat(e.t0.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function checkPartResultAsync(e,t){return _checkPartResultAsync.apply(this,arguments)}function _checkPartResultAsync(){return(_checkPartResultAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r){var n,a,o;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={type:"post",url:"".concat(domen,"/sveden/update/result_check_generate_part.php"),headers:{Accept:"application/json"},dataType:"json",data:{operation_identity:t,part:r}},e.next=4,requestToVuzRemoteScriptWithRepetitionAsync(n,!0,oauth);case 4:if(a=e.sent,200===(o=a.respData).forward_code){e.next=8;break}throw new Error(o.message?o.message:"неопознанная ошибка");case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),new Error("Ошибка при получении результатов генерации архива с разделом: ".concat(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function createPartRequestAsync(e){return _createPartRequestAsync.apply(this,arguments)}function _createPartRequestAsync(){return(_createPartRequestAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t){var r,n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={type:"post",url:"".concat(domen,"/sveden/update/request_generate_part.php"),headers:{Accept:"application/json"},dataType:"json",data:{part:t}},e.next=4,requestToVuzRemoteScriptWithRepetitionAsync(r,!0,oauth);case 4:if(n=e.sent,200===(a=n.respData).forward_code&&void 0!==a.operation_identity&&void 0!==a.ttl){e.next=8;break}throw new Error(a.message?a.message:"Неопознанная ошибка");case 8:return e.abrupt("return",{operationIdentity:a.operation_identity,ttl:a.ttl});case 11:throw e.prev=11,e.t0=e.catch(0),new Error("Ошибка в инициализации генерации архива: ".concat(e.t0.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function completeAsync(){return _completeAsync.apply(this,arguments)}function _completeAsync(){return(_completeAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:"get",url:"".concat(domen,"/sveden/update/cleaner.php"),headers:{Accept:"application/json"},dataType:"json"},e.prev=1,progressControl.setVal(80),e.next=5,versionUpAsync();case 5:return progressControl.setVal(90),updater.addMessage("Начинается удаление временных файлов."),e.next=9,requestToVuzRemoteScriptWithRepetitionAsync(t,!1,oauth);case 9:if(r=e.sent,200===(n=r.respData).forward_code){e.next=13;break}throw new Error(n.message);case 13:return e.next=15,showUpdateEndMessage(!0);case 15:updater.addMessage("Обновление завершено"),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),console.log(e.t0),clearTmpFilesErrorLayout.show().html(e.t0.message);case 22:progressControl.setVal(100);case 23:case"end":return e.stop()}}),e,null,[[1,18]])})))).apply(this,arguments)}function versionUpAsync(){return _versionUpAsync.apply(this,arguments)}function _versionUpAsync(){return(_versionUpAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={type:"post",url:"".concat(domen,"/sveden/update/complete.php"),headers:{Accept:"application/json"},dataType:"json",data:{}},e.next=4,requestToVuzRemoteScriptWithRepetitionAsync(t,!0,oauth);case 4:if(r=e.sent,200===(n=r.respData).forward_code){e.next=8;break}throw new Error(n.message?n.message:"неопознанная ошибка");case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),new Error("Ошибка при попытке отправить запрос на завершение обновления: ".concat(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function getCountFiles(){progressControl.setVal(70),updater.resetSettings(),updater.setUrl("".concat(domen,"/sveden/update/get_count_files.php")),updater.setData({access_token:oauth.getToken()}),updater.addMessage("Запрос количества файлов."),updater.sendAjax(!0,"res.count > 0 ? getPackFiles(res.count, 0) : completeAsync()").then((function(e){e.count>0?getPackFiles(e.count,0):$_vikon('input[name="sync"]').is(":checked")?getFilesForSync():completeAsync()}))}function getPackFiles(e,t){t<=e?(updater.resetSettings(),updater.setUrl("".concat(domen,"/sveden/update/get_pack_files.php")),updater.setData({access_token:oauth.getToken(),startFiles:t,filesForPart:countFilesInBatch}),updater.sendAjax(!0,"getPackFiles(".concat(e,", ").concat(t+countFilesInBatch,")")).then((function(r){getPackFiles(e,t+countFilesInBatch)}))):$_vikon('input[name="sync"]').is(":checked")?getFilesForSync():completeAsync()}function getFilesForSync(){progressControl.setVal(70),updater.resetSettings(),updater.setUrl("".concat(domen,"/sveden/update/get_files_for_sync.php")),updater.setData({access_token:oauth.getToken()}),updater.sendAjax(!0,"if (res.files.length > 0) { filesForSync = res.files; getPackFilesForSync(0); } else { completeAsync();}").then((function(e){e.files.length>0?(filesForSync=e.files,getPackFilesForSync(0)):completeAsync()}))}function getPackFilesForSync(e){if(e<filesForSync.length){for(var t=[],r=e;r<e+countFilesInBatch;r++)r in filesForSync&&(t[t.length]=filesForSync[r]);updater.resetSettings(),updater.setUrl("".concat(domen,"/sveden/update/get_pack_files_for_sync.php")),updater.setData({access_token:oauth.getToken(),files:t}),updater.setMethodAjax("POST"),updater.sendAjax(!0,"getPackFilesForSync(".concat(e+countFilesInBatch,")")).then((function(t){getPackFilesForSync(e+countFilesInBatch)}))}else updater.addMessage("Синхронизация файлов завершена."),completeAsync()}function showUpdateEndMessage(e){return new Promise((function(t){progressControl.setDeactive(),e?(updateComplete.removeClass("alert-danger").addClass("alert-success"),updateComplete.html("Обновление завершено")):(updateComplete.removeClass("alert-success").addClass("alert-danger"),updateComplete.html("Обновление завершено c ошибками")),updateComplete.show(),t(e)}))}function getAccessListAsync(){return _getAccessListAsync.apply(this,arguments)}function _getAccessListAsync(){return(_getAccessListAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:"get",url:"".concat(apiDomen,"pull_updates/assist/getUserAccessListJson"),headers:{Accept:"application/json"},dataType:"json",data:{}},e.prev=1,e.next=4,requestToWorldWithRepetitionAsync(t,!1,oauth);case 4:return r=e.sent,n=r.respData,e.abrupt("return",n.access);case 9:throw e.prev=9,e.t0=e.catch(1),a=tryExtractErrorFromSimpleAjaxPromise(e.t0),new Error("Ошибка при получении прав пользователя".concat(a?": ".concat(a):""));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function getVersionAsync(){return _getVersionAsync.apply(this,arguments)}function _getVersionAsync(){return(_getVersionAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:"get",url:"".concat(apiDomen,"pull_updates/assist/getUpdateVersionJson"),headers:{Accept:"application/json"},dataType:"json",data:{}},e.prev=1,e.next=4,requestToWorldWithRepetitionAsync(t,!1,oauth);case 4:return r=e.sent,n=r.respData,e.abrupt("return",n.version);case 9:throw e.prev=9,e.t0=e.catch(1),a=tryExtractErrorFromSimpleAjaxPromise(e.t0),new Error("Ошибка при получении версии обновления для вашей ОО".concat(a?": ".concat(a):""));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function completeErrorAsync(){return _completeErrorAsync.apply(this,arguments)}function _completeErrorAsync(){return(_completeErrorAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){var t,r,n,a;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:"post",url:"".concat(apiDomen,"pull_updates/assist/updateEndedErroredJson"),headers:{Accept:"application/json"},dataType:"json",data:{d:domen}},r={type:"get",url:"".concat(domen,"/sveden/update/cleaner.php"),headers:{Accept:"application/json"},dataType:"json"},e.prev=2,e.next=5,requestToWorldWithRepetitionAsync(t,!1,oauth);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return e.next=11,showUpdateEndMessage(!1);case 11:return e.prev=11,e.next=14,requestToVuzRemoteScriptWithRepetitionAsync(r,!1,oauth);case 14:if(n=e.sent,200===(a=n.respData).forward_code){e.next=18;break}throw new Error(a.message);case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(11),clearTmpFilesErrorLayout.show().html(e.t1.message);case 23:progressControl.setVal(100);case 24:case"end":return e.stop()}}),e,null,[[2,7],[11,20]])})))).apply(this,arguments)}function requestToVuzRemoteScriptWithRepetitionAsync(e,t,r){return _requestToVuzRemoteScriptWithRepetitionAsync.apply(this,arguments)}function _requestToVuzRemoteScriptWithRepetitionAsync(){return(_requestToVuzRemoteScriptWithRepetitionAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r,n){var a,o,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,requestToVuzRemoteScriptAsync(t,r,n);case 3:if(a=e.sent,o=a.respData,s=a.jqXHR,401!==o.forward_code){e.next=15;break}return e.next=9,n.setToken();case 9:if(!e.sent){e.next=14;break}return e.next=13,requestToVuzRemoteScriptAsync(t,r,n);case 13:return e.abrupt("return",e.sent);case 14:throw new Error("Отсутствует аутентификация. Выполните вход в систему");case 15:return e.abrupt("return",{respData:o,jqXHR:s});case 18:throw e.prev=18,e.t0=e.catch(0),console.log(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[0,18]])})))).apply(this,arguments)}function requestToVuzRemoteScriptAsync(e,t,r){return _requestToVuzRemoteScriptAsync.apply(this,arguments)}function _requestToVuzRemoteScriptAsync(){return(_requestToVuzRemoteScriptAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r,n){var a,o,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r?t.data.access_token=n.getToken():t.headers.Authorization="Bearer ".concat(n.getToken()),e.next=4,simpleAjaxPromiseRequest(t);case 4:if(a=e.sent,o=a.respData,s=a.jqXHR,!o.forward_code){e.next=9;break}return e.abrupt("return",{respData:o,jqXHR:s});case 9:throw new Error("Не верный формат ответа для данного метода");case 12:throw e.prev=12,e.t0=e.catch(0),console.log(e.t0),new Error("Не удалось разобрать ответ сервера в процессе выполнения запроса");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function requestToWorldWithRepetitionAsync(e,t,r){return _requestToWorldWithRepetitionAsync.apply(this,arguments)}function _requestToWorldWithRepetitionAsync(){return(_requestToWorldWithRepetitionAsync=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r,n){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r?t.data.access_token=n.getToken():t.headers.Authorization="Bearer ".concat(n.getToken()),e.next=4,simpleAjaxPromiseRequest(t);case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(0),401!==e.t0.jqXHR.status){e.next=17;break}return e.next=12,n.setToken();case 12:if(!e.sent){e.next=16;break}return r?t.data.access_token=n.getToken():t.headers.Authorization="Bearer ".concat(n.getToken()),e.abrupt("return",simpleAjaxPromiseRequest(t));case 16:case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function simpleAjaxPromiseRequest(e){return _simpleAjaxPromiseRequest.apply(this,arguments)}function _simpleAjaxPromiseRequest(){return(_simpleAjaxPromiseRequest=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.success=function(t,r,n){e({respData:t,jqXHR:n})},t.error=function(e,t){r({jqXHR:e,jqxhrException:t})},$_vikon.ajax(t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tryExtractErrorFromSimpleAjaxPromise(e){var t="";try{if("timeout"===e.jqxhrException)t="Timeout request error";else if("abort"===e.jqxhrException)t="Aborted request error";else if(e.jqXHR.status>0){t=JSON.parse(e.jqXHR.responseText).message}else 0===e.jqXHR.status&&(t="No connect to server ")}catch(e){console.log(e)}return t}$btnEnter.on("click",(function(){window.location.href="".concat(apiDomen,"oauth2/authorize?response_type=code&client_id=").concat(clientId,"&redirect_uri=").concat(domen,"/sveden/update/index.php")})),btnExit.on("click",(function(){window.localStorage&&(window.localStorage.removeItem("vikon_access_token"),window.localStorage.removeItem("vikon_refresh_token"),window.localStorage.removeItem("vikon_code"))})),$_vikon("#select-all").on("change",(function(){var e=$_vikon(".settings-update").find('input[type="checkbox"]:enabled');$_vikon(this).is(":checked")?e.prop("checked",!0):e.prop("checked",!1)})),startUpdate.on("click",_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return startUpdate.hide(),progressbarContainer.show(),processContainer.show(),debugMode=$_vikon('input[name="debug_mode"]').is(":checked")?1:0,((countFilesInBatch=Number($_vikon('select[name="count-files-in-batch"]').val()))<1||countFilesInBatch>5)&&(countFilesInBatch=5),e.next=8,get();case 8:case"end":return e.stop()}}),e)}))))},1061:function(e,t,r){"use strict";r.r(t);r(126),r(284),r(1055),r(285)},127:function(e,t,r){var n=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function _(e,t,r,n){var a=t&&t.prototype instanceof m?t:m,o=Object.create(a.prototype),s=new T(n||[]);return o._invoke=function(e,t,r){var n=p;return function(a,o){if(n===d)throw new Error("Generator is already running");if(n===f){if("throw"===a)throw o;return R()}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===h)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var i=u(e,t,r);if("normal"===i.type){if(n=r.done?f:l,i.arg===h)continue;return{value:i.arg,done:r.done}}"throw"===i.type&&(n=f,r.method="throw",r.arg=i.arg)}}}(e,r,s),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=_;var p="suspendedStart",l="suspendedYield",d="executing",f="completed",h={};function m(){}function g(){}function y(){}var v={};i(v,o,(function(){return this}));var E=Object.getPrototypeOf,b=E&&E(E(D([])));b&&b!==r&&n.call(b,o)&&(v=b);var w=y.prototype=m.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){i(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(a,o,s,c){var i=u(e[a],e,o);if("throw"!==i.type){var _=i.arg,p=_.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){_.value=e,s(_)}),(function(e){return r("throw",e,s,c)}))}c(i.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function P(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method))return h;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var a=u(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function D(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,s=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:R}}function R(){return{value:t,done:!0}}return g.prototype=y,i(w,"constructor",y),i(y,"constructor",g),g.displayName=i(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,i(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},k(A.prototype),i(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var s=new A(_(t,r,n,a),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(w),i(w,c,"Generator"),i(w,o,(function(){return this})),i(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=D,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],c=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var i=n.call(s,"catchLoc"),_=n.call(s,"finallyLoc");if(i&&_){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!_)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},206:function(e,t,r){"use strict";(function(t){e.exports=function(){if("object"==typeof globalThis)return globalThis;var e;try{e=this||new Function("return this")()}catch(e){if("object"==typeof window)return window;if("object"==typeof self)return self;if(void 0!==t)return t}return e}()}).call(this,r(59))},5:function(e,t){function r(e,t,r,n,a,o,s){try{var c=e[o](s),i=c.value}catch(e){return void r(e)}c.done?t(i):Promise.resolve(i).then(n,a)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var s=e.apply(t,n);function c(e){r(s,a,o,c,i,"next",e)}function i(e){r(s,a,o,c,i,"throw",e)}c(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},582:function(e,t,r){"use strict";function n(e){var t=e.substr(1),r={};return t.split("&").forEach((function(e){var t=e.split("=");r[t[0]]=decodeURIComponent(t[1])})),r}r.d(t,"a",(function(){return n}))},59:function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}});
//# sourceMappingURL=sveden.update.js.map